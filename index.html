<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@3.0.3/dist/aframe-event-set-component.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.1.0/dist/aframe-environment-component.min.js"></script>

  </head>
  <body>
    <a-scene>
      <a-entity environment position="45 0 15" rotation="0 0 0">
        <a-entity camera look-controls wasd-controls="acceleration:100" position="0 5 0">
			<a-entity cursor="fuse: true; fuseTimeout: 500"
            position="0 0 -2"
            geometry="primitive: ring; radiusInner: 0.001; radiusOuter: 0.01"
            material="color: white; shader: flat"></a-entity>
      </a-entity>
      </a-entity>

      <a-entity text="value: Average Happiness for Twitter during the COVID-19 pandemic; align:center;" position="45 7 0" scale="12 12 12" width="600pt"></a-entity>


      
      <a-box scale="14.5 0.5 1" position="7 1 0"color="white"></a-box>
      <a-box scale="15.5 0.5 1" position="22 1 0" color="#aaaaaa"></a-box>
      <a-box scale="15 0.5 1" position="37.25 1 0" color="white"></a-box>
      <a-box scale="15.5 0.5 1" position="52.5 1 0" color="#aaaaaa"></a-box>
      <a-box scale="14 0.5 1" position="67.25 1 0" color="white"></a-box>
	</a-scene>

  <script>
    // fake data
    var data = []
    var data1 = [5.95,5.98,5.97,5.95,5.93,5.94,5.94,5.95,5.96,5.99,5.96,5.96,5.97,6.04,
    5.99,5.99,6.00,5.96,5.93,5.95,5.99,5.99,5.97,5.96,5.92,5.91,5.89,5.89,5.92,
    5.95,5.92,5.92,5.90,5.89,5.91,5.91,5.95,5.86,5.86,5.79,5.71,5.72,5.77,5.78,
    5.75,5.75,5.73,5.75,5.77,5.80,5.78,5.75,5.77,5.81,5.83,5.83,5.82,5.80,5.82,
    5.82,5.80,5.82,5.84,5.85,5.84,5.84,5.87,5.86,5.86,5.88,5.88,5.90,5.86,5.87,
    5.88,5.89,5.88,5.88,5.88,5.88,5.89,5.89,5.91,5.91,5.90,5.91,5.90,5.90,5.91,
    5.92,5.94,5.91,5.89,5.90,5.90,5.91,5.87,5.90,5.93,5.96,5.91,5.90,5.90,5.91,
    5.93,5.93,5.92,5.92,5.97,5.97,5.94,5.94,5.93,5.91,5.93,5.98,5.82,5.76,5.66,
    5.67,5.63,5.66,5.67,5.69,5.72,5.75,5.78,5.80,5.79,5.81,5.83,5.83,5.86,5.86,
    5.82,5.82,5.85,5.85,5.84,5.88,5.84,5.94,5.89,5.83,5.85,5.87,5.89,5.89,5.88]
               
     var animals = ["2020-02-01","2020-02-02","2020-02-03","2020-02-04","2020-02-05","2020-02-06","2020-02-07","2020-02-08","2020-02-09","2020-02-10","2020-02-11","2020-02-12","2020-02-13","2020-02-14",
     "2020-02-15","2020-02-16","2020-02-17","2020-02-18","2020-02-19","2020-02-20","2020-02-21","2020-02-22","2020-02-23","2020-02-24","2020-02-25","2020-02-26","2020-02-27","2020-02-28","2020-02-29",
     "2020-03-01","2020-03-02","2020-03-03","2020-03-04","2020-03-05","2020-03-06","2020-03-07","2020-03-08","2020-03-09","2020-03-10","2020-03-11","2020-03-12","2020-03-13","2020-03-14","2020-03-15",
     "2020-03-16","2020-03-17","2020-03-18","2020-03-19","2020-03-20","2020-03-21","2020-03-22","2020-03-23","2020-03-24","2020-03-25","2020-03-26","2020-03-27","2020-03-28","2020-03-29","2020-03-30",
     "2020-03-31","2020-04-01","2020-04-02","2020-04-03","2020-04-04","2020-04-05","2020-04-06","2020-04-07","2020-04-08","2020-04-09","2020-04-10","2020-04-11","2020-04-12","2020-04-13","2020-04-14",
     "2020-04-15","2020-04-16","2020-04-17","2020-04-18","2020-04-19","2020-04-20","2020-04-21","2020-04-22","2020-04-23","2020-04-24","2020-04-25","2020-04-26","2020-04-27","2020-04-28","2020-04-29",
     "2020-04-30","2020-05-01","2020-05-02","2020-05-03","2020-05-04","2020-05-05","2020-05-06","2020-05-07","2020-05-08","2020-05-09","2020-05-10","2020-05-11","2020-05-12","2020-05-13","2020-05-14",
     "2020-05-15","2020-05-16","2020-05-17","2020-05-18","2020-05-19","2020-05-20","2020-05-21","2020-05-22","2020-05-23","2020-05-24","2020-05-25","2020-05-26","2020-05-27","2020-05-28","2020-05-29",
     "2020-05-30","2020-05-31","2020-06-01","2020-06-02","2020-06-03","2020-06-04","2020-06-07","2020-06-08","2020-06-09","2020-06-10","2020-06-11","2020-06-12","2020-06-13","2020-06-14","2020-06-15",
     "2020-06-16","2020-06-17","2020-06-18","2020-06-19","2020-06-20","2020-06-21","2020-06-22","2020-06-23","2020-06-24","2020-06-25","2020-06-26","2020-06-27","2020-06-28","2020-06-29","2020-06-30"]

    // we scale the height of our bars using d3's linear scale
    data = data1
    var hscale = d3.scale.linear()
    	.domain([d3.min(data), d3.max(data)])
    	.range([0.5, 3])
    
    // we select the scene object just like an svg
    var scene = d3.select("a-scene")
    
    // we use d3's enter/update/exit pattern to draw and bind our dom elements
    var bars = scene.selectAll("a-box.bar").data(data)
    bars.enter().append("a-cylinder").classed("bar", true)

    $(".bar").append("<a-text> </a-text>");
    // we set attributes on our cubes to determine how they are rendered
    bars.attr({
      position: function(d,i) {
        var x =  i/2;
        var y = 1 + hscale(d)/2 ;
        var z = 0;
        return x + " " + y + " " + z
      },
      height: function(d) { return hscale(d)},
      color: 'cyan',
      radius:0.2,
      //depth:0.4,
      //shader: 'flat',
      //'segments-radial':"6"
    })
    .on("click", function(d,i) {
      console.log("click", i,d)
    })
    .on("mouseenter", function(d,i) {
      // this event gets fired continuously as long as the cursor
      // is over the element. we only want trigger our animation the first time
      if(this.hovering) return;
      console.log("hover", i,d)
      this.hovering = true;
      d3.select(this).transition().duration(500)
      .attr({
        color:'#FF7F50'
      })
       d3.select(this).select("a-text")
      .attr({
	        	'color':'#ffffff',
	        	'align':'center',
	        	'position':'0 '+ (hscale(d)/2+1) + ' 0.5',
            'look-at':"[camera]",
	        	'scale':'2 2 2',
	        	'value': animals[i]+'\n '+d
      })
    })
    .on("mouseleave", function(d,i) {
      console.log("leave",i,d)
      this.hovering = false;
      d3.select(this).transition().duration(50)
      .attr({
        color:'cyan',
      })
       d3.select(this).select("a-text")
      .attr({
	        	'align':'center',
	        	'position':'0 '+ (hscale(d)/2+45) + ' 0',
	        	'value': d
      })
    })
  </script>
  <script>
    $(".bar").each(function() {
      this.components.material.material.depthWrite = false;
      this.components.material.material.needsUpdate = true;;
    });
    document.querySelector('#btn1').addEventListener("mouseover", function() {
        data = data1
        $(".bar").each(bars.attr({
      height: function(d) { return hscale(data)},
    }))
    });
	</script>
  <body>
</html>